version: 2

models:
  - name: document_question_extracts
    description: "Question extracts from documents using AI_EXTRACT"
    config:
      docs_stage_path: "@INCIDENT_MANAGEMENT.bronze_zone.DOCUMENTS"
      meta:
        global_inm_policy_schema:
          enabled: false
          schema:
            type: "object"
            properties:
                purpose: { description: "Purpose of this policy", type: "string" }
                objectives: { description: "Objectives achieved by this policy", type: "string" }
                policy_statement: { description: "Primary policy statement", type: "string" }
                in_scope_services: { description: "Services explicitly in scope", type: "array" }
                out_of_scope_services: { description: "Services explicitly out of scope", type: "array" }
                geographical_coverage: { description: "Countries/regions covered", type: "array" }
                business_units_in_scope: { description: "Business units covered by the policy", type: "array" }
                applicability_conditions: { description: "Conditions determining when policy applies", type: "array" }
                exclusions: { description: "Explicit exceptions to scope", type: "array" }
                definitions_and_glossary:
                    description: "Terms, acronyms, and reference standards"
                    type: "object"
                    properties:
                        defined_terms: { description: "Key defined terms", type: "array" }
                        acronyms: { description: "Acronyms used within the document", type: "array" }
                        reference_standards: { description: "Referenced standards and frameworks", type: "array" }
        quaterly_review_metrics:
          enabled: true
          schema:
            type: "object"
            properties:
              quarter: { description: "What is the year and quarter of the review metrics?", type: "string" }
              service_operational_health:
                description: "Service operational health for a given quarter"
                type: "object" 
                properties:
                  overall_uptime: { description: "What was the actual recorded overall uptime of all services", type: "number" }
                  critical_services_uptime: { description: "What was the actual recorded  uptime of critical services", type: "number" }
                  sev_1_incidents: { description: "What were the actual recorded number of Sev-1 incidents", type: "number" }
                  sev_2_incidents: { description: "What were the actual recorded number of Sev-2 incidents", type: "number" }
                  mtta: { description: "What was the actual recorded mean time to acknowledge an incident", type: "number" }
                  mttr: { description: "What was the actual recorded mean time to recover from an incident", type: "number" }
                  change_failure_rate: { description: "What was the actual recorded change failure rate", type: "number" }
                  slo_breaches: { description: "What was the actual recorded number of SLO breaches", type: "number" }
                  error_budget_consumed: { description: "What was the actual recorded error budget consumed", type: "number" }
                  service_downtime: { description: "What was the actual recorded service downtime", type: "number" } 
                  unplanned_outage_hours: { description: "What was the actual recorded unplanned outage hours", type: "number" }
                  planned_maintenance_hours: { description: "What was the actual recorded planned maintenance hours", type: "number" }
                  sev_1_outage_minutes: { description: "What was the actual recorded Sev-1 outage minutes", type: "number" }
                  sev_2_outage_minutes: { description: "What was the actual recorded Sev-2 outage minutes", type: "number" }
                  longest_single_outage: { description: "What was the actual recorded longest single outage", type: "number" }
                  mtbft: { description: "What was the actual recorded mean time between failures", type: "number" }
              team_utilisation:
                description: "Team utilisation for a given quarter"
                type: "object"
                properties:
                  end_of_quarter_it_headcount: { description: "What was the actual recorded end of quarter IT headcount", type: "number" }
                  engineering_headcount: { description: "What was the actual recorded engineering headcount", type: "number" }
                  on_call_coverage: { description: "What was the actual recorded on call coverage", type: "number" }
                  project_work_allocation: { description: "What was the actual recorded project work allocation", type: "number" }
                  bau_operations_allocation: { description: "What was the actual recorded BAU/Operations allocation", type: "number" }
                  on_call_hours_per_engineer: { description: "What was the actual recorded on call hours per engineer", type: "number" }
                  after_hours_incidents_handled: { description: "What was the actual recorded after hours incidents handled", type: "number" }
                  training_hours_per_fte: { description: "What was the actual recorded training hours per FTE", type: "number" }                  
                  certifications_earned: { description: "What was the actual recorded certifications earned", type: "number" }
                  attrition: { description: "What was the actual recorded attrition", type: "number" }
              tool_licensing_spend:
                description: "Tool licensing spend for a given quarter"
                type: "object"
                properties:
                  atlassian_spend: { description: "What was the actual spend on Atlassian licenses", type: "number" }
                  github_spend: { description: "What was the actual spend on GitHub licenses", type: "number" }
                  slack_spend: { description: "What was the actual spend on Slack licenses", type: "number" }
                  pagerduty_spend: { description: "What was the actual spend on PagerDuty licenses", type: "number" }
                  datadog_spend: { description: "What was the actual spend on Datadog licenses", type: "number" }
                  sentry_spend: { description: "What was the actual spend on Sentry licenses", type: "number" }
                  okta_spend: { description: "What was the actual spend on Okta licenses", type: "number" }
                  aws_spend: { description: "What was the actual spend on AWS licenses", type: "number" }
                  total_spend: { description: "What was the actual spend on total licenses", type: "number" }
              
    columns:
      - name: relative_path
        description: "Path to the file on the stage"
        tests:
          - not_null

      - name: size
        description: "Size of the file in bytes"

      - name: last_modified
        description: "Timestamp when the file was last updated in the stage"

      - name: md5
        description: "MD5 checksum for the file"

      - name: etag
        description: "ETag header for the file"

      - name: file_url
        description: "Snowflake file URL to the file"

      - name: analysis_type
        description: "Type of analysis requested for the file"
        tests:
          - accepted_values:
              values: ['question']

      - name: extension
        description: "File extension parsed from the path"

      - name: question_extracts_json
        description: "JSON output from AI_EXTRACT following the `global_inm_policy_schema.json` format"
  
