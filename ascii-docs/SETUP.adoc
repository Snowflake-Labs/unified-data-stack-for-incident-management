= Installation & Setup Guide
:toc:
:toc-placement!:

This guide walks you through setting up the unified data stack on Snowflake.

toc::[]


== Prerequisites

Before starting the installation, ensure you have:

* *Snowflake CLI* installed (link:https://docs.snowflake.com/en/developer-guide/snowflake-cli/installation/installation[installation guide])
* *Snowflake connection* configured in `~/.snowflake/config.toml`
* *ACCOUNTADMIN privileges* in your Snowflake account
* *Git* installed on your local machine
* *OpenFlow SPCS* deployment and runtime. Use these link:https://docs.snowflake.com/en/user-guide/data-integration/openflow/setup-openflow-spcs[installation instructions] to set up OpenFlow SPCS within your Snowflake account

== Key Directories

* *`data/`*: Sample and seed data for testing and initial setup
* *`docs/`*: Sample documents for text extraction and question extraction.
* *`src/incident_management/`*: Core dbt project with data models
* *`src/sql/`*: Infrastructure setup and raw SQL scripts
* *`src/streamlit/`*: Interactive dashboard application
* *`python_scripts/`*: Utility scripts for reporting and automation

== Installation Steps

This project demonstrates dbt Projects deployment and execution from a local dev machine. Once deployed, you can switch to Snowflake Workspaces to manage further redeployments and test executions.

. Fork and Clone the Repository
+
[source,bash]
----
git clone https://github.com/Snowflake-Labs/unified-data-stack-for-incident-management.git

cd unified-data-stack-for-incident-management

git remote add upstream <your-repository-url>

git remote -v
----

. Configure Environment Variables
+
Copy the template and configure your environment:
+
[source,bash]
----
cp .env.template .env
----
+
Edit the `.env` file and configure all variables except these two (generated later):
+
** `DBT_SNOWFLAKE_PASSWORD`
** `DBT_SNOWFLAKE_PRIVATE_KEY_PATH`
+
[NOTE]
====
If you change any of the below parameters, be sure to change the `profiles.yml` as well:

** `DBT_PROJECT_DATABASE=v1_incident_management`
** `DBT_PROJECT_SCHEMA=dbt_project_deployments`
** `MODEL_SCHEMA=bronze_zone`
** `DBT_SNOWFLAKE_WAREHOUSE=v1_demo_wh`
** `DBT_PROJECT_ADMIN_ROLE=dbt_projects_engineer`
====

. Setup Snowflake Infrastructure
+
Use the Makefile to automate the entire Snowflake setup.
+
[NOTE]
====
Replace `<your-connection-name>` with the connection name defined in your `~/.snowflake/config.toml`
====
+
[IMPORTANT]
====
Role setup commands require ACCOUNTADMIN privileges
====
+
.. Option A: Complete Setup (Recommended)
+
[source,bash]
----
# Run complete installation
make install ENV_FILE=.env CONN=<your-connection-name>
----

.. Option B: Step-by-Step Setup
+
For detailed information about available Makefile targets:
+
[source,bash]
----
make help
----
+
Run each step individually:
+
[source,bash]
----
# Step 1: Generate snowflake.yml configuration
make generate-yaml ENV_FILE=.env

# Step 2: Setup dbt Projects infrastructure
make setup-dbt-stack CONN=<your-connection-name>

# Step 3: Setup Slack connector infrastructure
make setup-slack-connector CONN=<your-connection-name>

# Step 4: Setup Snowflake tasks
make setup-tasks CONN=<your-connection-name>

# Step 5: Setup procedures and functions
make setup-procs-funcs CONN=<your-connection-name>
----

. Slack Connector Configuration
+
After running the Makefile setup, configure the Slack connector in your OpenFlow SPCS runtime.

.. Review Prerequisites
+
Check the link:https://docs.snowflake.com/en/user-guide/data-integration/openflow/connectors/slack/setup#prerequisites[pre-requisites] for the Slack connector.

.. Create Slack App
+
Create a Slack app in your workspace using the given link:https://docs.snowflake.com/en/user-guide/data-integration/openflow/connectors/slack/setup#set-up-a-slack-app[manifest].

.. Generate App Token
+
While creating your Slack app, ensure to generate the App token using at least the below scope:
+
* `connections:write`

.. Update External Access in Snowflake
+
link:https://docs.snowflake.com/en/user-guide/data-integration/openflow/connectors/slack/setup#setup-necessary-ingress-rules[Update] the External Access Integration object to add `slack.com` domain for egress from SPCS containers.

.. Configure Connector in OpenFlow Runtime Canvas
+
Use these link:https://docs.snowflake.com/en/user-guide/data-integration/openflow/connectors/slack/setup#configure-the-connector[instructions] to configure the connector. 
Ensure to use the database and role parameters created by the Makefile (values in the screenshot may change based on configuration within .env file):
+
image::destination_params.png[Destination Parameters]
image::snowflake_role_params.png[Snowflake Role Parameters]

.. Start and Test
+
Start the connector and add the Slack app to a channel. Verify these tables are created:
+
* `SLACK_MEMBERS`
* `SLACK_MEMBERS_STAGING`
* `DOC_METADATA`
* `FILE_HASHES`
* `SLACK_MESSAGES`

.. Test Message Ingestion
+
Drop a test message in your Slack channel and verify that a record appears in the `SLACK_MESSAGES` table (might take a few seconds).

. Streamlit Dashboard

.. Accessing the Dashboard
+
After completing the setup, a Streamlit in Snowflake (SiS) app will be deployed to your Snowflake account. This enables you to run through foundational scenarios end-to-end.

.. Dashboard Features
+
* *Metrics Overview*: Critical, high-priority, active, and recently closed incident counts
* *Active Incidents Table*: Real-time view of open incidents with priority indicators
* *Recently Closed Incidents*: Track resolution times and outcomes
* *Attachment Viewer*: Click on incidents with attachments to view images
* *Trend Analysis*: Monthly and weekly incident patterns (when data is available)

.. Managing Incidents via Slack
+
... *Report New Incidents*: Post messages in configured Slack channels
... *Automatic Processing*: The system will:
+
** Extract incident details from messages
** Classify incident type and priority using AI
** Process attached images for additional context
** Create structured incident records
... *Track Progress*: Monitor incidents through the Streamlit dashboard

'''

link:../README.adoc[← To README] ||| link:../demos.adoc[→ To Demo Vignettes]

'''
